<!DOCTYPE html>
<html lang="en"><!-- use theme color or fallback -->
<!--use textcolor from settings, otherwise create a contrasting color to theme color-->
<head><meta charset="utf-8"/><link href="../../bootstrap/css/bootstrap.min.css" rel="stylesheet"/><link href="../../bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet"/><link href="../../bootstrap/css/bootstrap-select.min.css" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,700italic,400italic" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600,600italic,400" rel="stylesheet" type="text/css"/><link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css" rel="stylesheet" type="text/css"/><script src="../../jquery-1.9.1.min.js"></script><script src="../../bootstrap/js/bootstrap.min.js"></script><script src="../../bootstrap/js/bootstrap-select.min.js"></script><link href="../../styles.css" rel="stylesheet"/><link href="../../extra-styles.css" rel="stylesheet"/><link href="../../haxe-nav.css" rel="stylesheet"/><script type="text/javascript">var dox = {rootPath: "../../",platforms: ["cpp","cs","flash","hl","java","js","lua","macro","neko","php","python"]};</script><script type="text/javascript" src="../../nav.js"></script><script type="text/javascript" src="../../index.js"></script><link rel="icon" href="../../favicon.ico" type="image/x-icon"></link><title>cpp.net.ThreadServer - Haxe development API</title><meta name="description" content="The ThreadServer can be used to easily create a multithreaded server where each thread polls multiple connections.
To use it, at a minimum you must override or rebind clientConnected, readClientMessage, and clientMessage and you must define your Client and Message."/><link rel="canonical" href="https://api.haxe.org/v/development/cpp/net/ThreadServer.html"/><script type="text/javascript">function startsWith(str, searchString){    return str.substr(0, searchString.length) === searchString;}if (!startsWith(location.href, "https://api.haxe.org/v/development")) {window.location.replace("https://api.haxe.org/v/development/cpp/net/ThreadServer.html");}</script></head><body><style>
.main-content {
	margin-top:65px;
}
.nav-list>.active>a.treeLink, .nav-list>.active>a.treeLink:hover, .nav-list>.active>a.treeLink:focus {
	background:#F48821;
	color:#fff;
	text-shadow:0 0 0 transparent;
}
</style><nav class="section nav dark"><div class="navbar navbar-fixed-top navbar-inverse"><div class="navbar-inner"><button class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse" type="button"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button><a class="brand haxe-logo" href="https://haxe.org/"><img alt="Haxe" height="21" onerror="this.src='https://haxe.org/img/haxe-logo-horizontal-on-dark.png'" src="https://haxe.org/img/haxe-logo-horizontal-on-dark.svg" width="107"/></a><a class="brand sub lib" href="../../">API</a><div class="nav-collapse collapse"><ul class="nav"><!-- required submenu  on every subsite, put class="active" on   -->
<li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="https://haxe.org/documentation/">Learn Haxe <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="https://haxe.org/documentation/">Introduction</a></li><li class="divider"></li><li><a href="https://haxe.org/manual/">Manual</a></li><li class="active"><a href="http://api.haxe.org">API Documentation</a></li><li class="divider"></li><li><a href="http://try.haxe.org">Try Haxe</a></li><li><a href="https://lib.haxe.org">Haxelib</a></li><li><a href="http://code.haxe.org">Code Cookbook</a></li></ul></li><li class=" dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Connect <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="https://github.com/HaxeFoundation" rel="external"><i class="fa fa-github"></i> Github</a></li><li><a href="https://github.com/HaxeFoundation/haxe/issues" rel="external"><i class="fa fa-github"></i> Bug reports</a></li><li><a href="http://stackoverflow.com/questions/tagged/haxe" rel="external"><i class="fa fa-stack-exchange"></i> Stack Overflow</a></li><li><a href="http://groups.google.com/group/haxelang?hl=en" rel="external"><i class="fa fa-envelope-o"></i> Google Groups</a></li><li><a href="http://webchat.freenode.net/?channels=haxe" rel="external nofollow"><i class="fa fa-comments-o"></i> IRC</a></li><li><a href="https://haxe.org/blog" rel="external"><i class="fa fa-rss"></i> Blog</a></li><li class="divider"></li><li><a href="https://plus.google.com/communities/103302587329918132234" rel="external"><i class="fa fa-google-plus"></i> Google+</a></li><li><a href="https://www.facebook.com/haxe.org/" rel="external"><i class="fa fa-facebook"></i> Facebook</a></li><li><a href="https://twitter.com/search?q=%23haxe" rel="external"><i class="fa fa-twitter"></i> #haxe</a></li><li><a href="https://twitter.com/haxelang" rel="external"><i class="fa fa-twitter"></i> @haxelang</a></li><li><a href="https://twitter.com/haxe_org" rel="external"><i class="fa fa-twitter"></i> @haxe_org</a></li><li class="divider"></li><li><a href="https://haxe.org/foundation/contact.html">Contact</a></li></ul></li></ul></div></div></div></nav><div class="container main-content"><div class="row-fluid"><div class="span3"><div class="well sidebar-nav"><form class="form-search" id="searchForm"><div class="input-prepend input-block-level"><span class="add-on"><i class="icon-search"></i></span><input id="search" type="text" placeholder="Filter" autocomplete="off"/></div></form><div class="dropdown"><select id="select-platform" class="selectpicker" title="Filter by platform" data-width="100%"><option value="all" selected="true">All Platforms</option><option>cpp</option><option>cs</option><option>flash</option><option>hl</option><option>java</option><option>js</option><option>lua</option><option>macro</option><option>neko</option><option>php</option><option>python</option></select></div></div><div class="well sidebar-nav"><div id="nav"></div></div></div><div class="span9"><div class="page-header"><span class="viewsource"><a href="https://github.com/HaxeFoundation/haxe/blob/development/std/cpp/net/ThreadServer.hx" class="btn btn-medium"><i class="fa fa-eye"></i> View source</a></span><h1><small>class</small> ThreadServer&lt;<span class="type">Client</span>, <span class="type">Message</span>&gt;</h1><h4><small>package <a href="../../cpp/net/index.html">cpp.net</a></small></h4>    <p class="availability"><hr/><em>Available on  cpp</em></p></div><div class="body"><div class="doc doc-main"><div class="indent"><p>The ThreadServer can be used to easily create a multithreaded server where each thread polls multiple connections.
To use it, at a minimum you must override or rebind clientConnected, readClientMessage, and clientMessage and you must define your Client and Message.</p></div></div><h3 class="section">Constructor</h3><div class="fields"><div class="field "><a name="new"></a><h3><p class="anchor"><code><a href="#new"><span class="identifier">new</span></a> ()</code></p></h3><div class="doc"><p>Creates a ThreadServer.</p></div></div></div><h3 class="section">Variables</h3><div class="fields"><div class="field "><a name="connectLag"></a><h3><p class="anchor"><code><a href="../../cpp/net/ThreadServer.html#connectLag"><span class="identifier">connectLag</span></a>:<a class="type" title="The standard Float type, this is a double-precision IEEE 64bit float." href="../../Float.html">Float</a></code></p></h3><div class="doc"><p>Polling timeout.</p></div></div><div class="field "><a name="errorOutput"></a><h3><p class="anchor"><code><a href="../../cpp/net/ThreadServer.html#errorOutput"><span class="identifier">errorOutput</span></a>:<a class="type" title="An Output is an abstract write." href="../../haxe/io/Output.html">Output</a></code></p></h3><div class="doc"><p>Stream to send error messages.</p></div></div><div class="field "><a name="initialBufferSize"></a><h3><p class="anchor"><code><a href="../../cpp/net/ThreadServer.html#initialBufferSize"><span class="identifier">initialBufferSize</span></a>:<a class="type" title="The standard Int type." href="../../Int.html">Int</a></code></p></h3><div class="doc"><p>Space allocated to buffers when they are created.</p></div></div><div class="field "><a name="listen"></a><h3><p class="anchor"><code><a href="../../cpp/net/ThreadServer.html#listen"><span class="identifier">listen</span></a>:<a class="type" title="The standard Int type." href="../../Int.html">Int</a></code></p></h3><div class="doc"><p>Number of total connections the server will accept.</p></div></div><div class="field "><a name="maxBufferSize"></a><h3><p class="anchor"><code><a href="../../cpp/net/ThreadServer.html#maxBufferSize"><span class="identifier">maxBufferSize</span></a>:<a class="type" title="The standard Int type." href="../../Int.html">Int</a></code></p></h3><div class="doc"><p>Maximum size of buffered data read from a socket. An exception is thrown if the buffer exceeds this value.</p></div></div><div class="field "><a name="maxSockPerThread"></a><h3><p class="anchor"><code><a href="../../cpp/net/ThreadServer.html#maxSockPerThread"><span class="identifier">maxSockPerThread</span></a>:<a class="type" title="The standard Int type." href="../../Int.html">Int</a></code></p></h3><div class="doc"><p>The most sockets a thread will handle.</p></div></div><div class="field "><a name="messageHeaderSize"></a><h3><p class="anchor"><code><a href="../../cpp/net/ThreadServer.html#messageHeaderSize"><span class="identifier">messageHeaderSize</span></a>:<a class="type" title="The standard Int type." href="../../Int.html">Int</a></code></p></h3><div class="doc"><p>Minimum message size.</p></div></div><div class="field "><a name="nthreads"></a><h3><p class="anchor"><code><a href="../../cpp/net/ThreadServer.html#nthreads"><span class="identifier">nthreads</span></a>:<a class="type" title="The standard Int type." href="../../Int.html">Int</a></code></p></h3><div class="doc"><p>Number of server threads.</p></div></div><div class="field "><a name="sock"></a><h3><p class="anchor"><code><span class="label">private</span><a href="../../cpp/net/ThreadServer.html#sock"><span class="identifier">sock</span></a>:<a class="type" title="A TCP socket class : allow you to both connect to a given server and exchange messages or start your own server and wait for connections." href="../../sys/net/Socket.html">Socket</a></code></p></h3><div class="doc"><p></p></div></div><div class="field "><a name="threads"></a><h3><p class="anchor"><code><span class="label">private</span><a href="../../cpp/net/ThreadServer.html#threads"><span class="identifier">threads</span></a>:<a class="type" title="An Array is a storage for values." href="../../Array.html">Array</a>&lt;<span class="type">ThreadInfos</span>&gt;</code></p></h3><div class="doc"><p></p></div></div><div class="field "><a name="timer"></a><h3><p class="anchor"><code><span class="label">private</span><a href="../../cpp/net/ThreadServer.html#timer"><span class="identifier">timer</span></a>:<a class="type" title="" href="../../cpp/vm/Thread.html">Thread</a></code></p></h3><div class="doc"><p></p></div></div><div class="field "><a name="updateTime"></a><h3><p class="anchor"><code><a href="../../cpp/net/ThreadServer.html#updateTime"><span class="identifier">updateTime</span></a>:<a class="type" title="The standard Float type, this is a double-precision IEEE 64bit float." href="../../Float.html">Float</a></code></p></h3><div class="doc"><p>Time between calls to update.</p></div></div><div class="field "><a name="worker"></a><h3><p class="anchor"><code><span class="label">private</span><a href="../../cpp/net/ThreadServer.html#worker"><span class="identifier">worker</span></a>:<a class="type" title="" href="../../cpp/vm/Thread.html">Thread</a></code></p></h3><div class="doc"><p></p></div></div></div><h3 class="section">Methods</h3><div class="fields"><div class="field "><a name="addClient"></a><h3><p class="anchor"><code><span class="label">private</span><a href="#addClient"><span class="identifier">addClient</span></a> (<span style="white-space:nowrap">sock:<a class="type" title="A TCP socket class : allow you to both connect to a given server and exchange messages or start your own server and wait for connections." href="../../sys/net/Socket.html">Socket</a></span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p></p></div></div><div class="field "><a name="addSocket"></a><h3><p class="anchor"><code><a href="#addSocket"><span class="identifier">addSocket</span></a> (<span style="white-space:nowrap">s:<a class="type" title="A TCP socket class : allow you to both connect to a given server and exchange messages or start your own server and wait for connections." href="../../sys/net/Socket.html">Socket</a></span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Called when the server gets a new connection.</p></div></div><div class="field "><a name="afterEvent"></a><h3><p class="anchor"><code><span class="label">dynamic</span><a href="#afterEvent"><span class="identifier">afterEvent</span></a> ():<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Called after a client connects, disconnects, a message is received, or an update is performed.</p></div></div><div class="field "><a name="clientConnected"></a><h3><p class="anchor"><code><span class="label">dynamic</span><a href="#clientConnected"><span class="identifier">clientConnected</span></a> (<span style="white-space:nowrap">s:<a class="type" title="A TCP socket class : allow you to both connect to a given server and exchange messages or start your own server and wait for connections." href="../../sys/net/Socket.html">Socket</a></span>):<span class="type">Client</span></code></p></h3><div class="doc"><p>Called when a client connects. Returns a client object.</p></div></div><div class="field "><a name="clientDisconnected"></a><h3><p class="anchor"><code><span class="label">dynamic</span><a href="#clientDisconnected"><span class="identifier">clientDisconnected</span></a> (<span style="white-space:nowrap">c:<span class="type">Client</span></span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Called when a client disconnects or an error forces the connection to close.</p></div></div><div class="field "><a name="clientMessage"></a><h3><p class="anchor"><code><span class="label">dynamic</span><a href="#clientMessage"><span class="identifier">clientMessage</span></a> (<span style="white-space:nowrap">c:<span class="type">Client</span>,</span> <span style="white-space:nowrap">msg:<span class="type">Message</span></span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Called when a message has been recieved. Message handling code should go here.</p></div></div><div class="field "><a name="doClientDisconnected"></a><h3><p class="anchor"><code><span class="label">private</span><a href="#doClientDisconnected"><span class="identifier">doClientDisconnected</span></a> (<span style="white-space:nowrap">s:<a class="type" title="A TCP socket class : allow you to both connect to a given server and exchange messages or start your own server and wait for connections." href="../../sys/net/Socket.html">Socket</a>,</span> <span style="white-space:nowrap">c:<span class="type">Client</span></span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p></p></div></div><div class="field "><a name="init"></a><h3><p class="anchor"><code><span class="label">private</span><a href="#init"><span class="identifier">init</span></a> ():<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p></p></div></div><div class="field "><a name="logError"></a><h3><p class="anchor"><code><span class="label">private</span><a href="#logError"><span class="identifier">logError</span></a> (<span style="white-space:nowrap">e:<a class="type" title="Dynamic is a special type which is compatible with all other types." href="../../Dynamic.html">Dynamic</a></span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p></p></div></div><div class="field "><a name="loopThread"></a><h3><p class="anchor"><code><span class="label">private</span><a href="#loopThread"><span class="identifier">loopThread</span></a> (<span style="white-space:nowrap">t:<span class="type">ThreadInfos</span></span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p></p></div></div><div class="field "><a name="onError"></a><h3><p class="anchor"><code><span class="label">dynamic</span><a href="#onError"><span class="identifier">onError</span></a> (<span style="white-space:nowrap">e:<a class="type" title="Dynamic is a special type which is compatible with all other types." href="../../Dynamic.html">Dynamic</a>,</span> <span style="white-space:nowrap">stack:<a class="type" title="An Array is a storage for values." href="../../Array.html">Array</a>&lt;<a class="type" title="Elements return by CallStack methods." href="../../haxe/StackItem.html">StackItem</a>&gt;</span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Called when an error has ocurred.</p></div></div><div class="field "><a name="readClientData"></a><h3><p class="anchor"><code><span class="label">private</span><a href="#readClientData"><span class="identifier">readClientData</span></a> (<span style="white-space:nowrap">c:<span class="type">ClientInfos</span>&lt;<span class="type">Client</span>&gt;</span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p></p></div></div><div class="field "><a name="readClientMessage"></a><h3><p class="anchor"><code><span class="label">dynamic</span><a href="#readClientMessage"><span class="identifier">readClientMessage</span></a> (<span style="white-space:nowrap">c:<span class="type">Client</span>,</span> <span style="white-space:nowrap">buf:<a class="type" title="" href="../../haxe/io/Bytes.html">Bytes</a>,</span> <span style="white-space:nowrap">pos:<a class="type" title="The standard Int type." href="../../Int.html">Int</a>,</span> <span style="white-space:nowrap">len:<a class="type" title="The standard Int type." href="../../Int.html">Int</a></span>):{msg:<span class="type">Message</span>, bytes:<a class="type" title="The standard Int type." href="../../Int.html">Int</a>}</code></p></h3><div class="doc"><p>Called when data has been read from a socket. This method should try to extract a message from the buffer.
The available data resides in buf, starts at pos, and is len bytes wide. Return the new message and the number of bytes read from the buffer.
If no message could be read, return null.</p></div></div><div class="field "><a name="refuseClient"></a><h3><p class="anchor"><code><span class="label">private</span><a href="#refuseClient"><span class="identifier">refuseClient</span></a> (<span style="white-space:nowrap">sock:<a class="type" title="A TCP socket class : allow you to both connect to a given server and exchange messages or start your own server and wait for connections." href="../../sys/net/Socket.html">Socket</a></span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p></p></div></div><div class="field "><a name="run"></a><h3><p class="anchor"><code><a href="#run"><span class="identifier">run</span></a> (<span style="white-space:nowrap">host:<a class="type" title="The basic String class." href="../../String.html">String</a>,</span> <span style="white-space:nowrap">port:<a class="type" title="The standard Int type." href="../../Int.html">Int</a></span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Start the server at the specified host and port.</p></div></div><div class="field "><a name="runThread"></a><h3><p class="anchor"><code><span class="label">private</span><a href="#runThread"><span class="identifier">runThread</span></a> (<span style="white-space:nowrap">t:<span class="type">ThreadInfos</span></span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p></p></div></div><div class="field "><a name="runTimer"></a><h3><p class="anchor"><code><span class="label">private</span><a href="#runTimer"><span class="identifier">runTimer</span></a> ():<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p></p></div></div><div class="field "><a name="runWorker"></a><h3><p class="anchor"><code><span class="label">private</span><a href="#runWorker"><span class="identifier">runWorker</span></a> ():<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p></p></div></div><div class="field "><a name="sendData"></a><h3><p class="anchor"><code><a href="#sendData"><span class="identifier">sendData</span></a> (<span style="white-space:nowrap">s:<a class="type" title="A TCP socket class : allow you to both connect to a given server and exchange messages or start your own server and wait for connections." href="../../sys/net/Socket.html">Socket</a>,</span> <span style="white-space:nowrap">data:<a class="type" title="The basic String class." href="../../String.html">String</a></span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Send data to a client.</p></div></div><div class="field "><a name="stopClient"></a><h3><p class="anchor"><code><a href="#stopClient"><span class="identifier">stopClient</span></a> (<span style="white-space:nowrap">s:<a class="type" title="A TCP socket class : allow you to both connect to a given server and exchange messages or start your own server and wait for connections." href="../../sys/net/Socket.html">Socket</a></span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Shutdown a client's connection and remove them from the server.</p></div></div><div class="field "><a name="update"></a><h3><p class="anchor"><code><span class="label">dynamic</span><a href="#update"><span class="identifier">update</span></a> ():<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>This method is called periodically. It can be used to do server maintenance.</p></div></div><div class="field "><a name="work"></a><h3><p class="anchor"><code><a href="#work"><span class="identifier">work</span></a> (<span style="white-space:nowrap">f:<a class="type" title="The standard Void type." href="../../Void.html">Void</a>&nbsp;&#8209;&gt;&nbsp;<a class="type" title="The standard Void type." href="../../Void.html">Void</a></span>):<a class="type" title="The standard Void type." href="../../Void.html">Void</a></code></p></h3><div class="doc"><p>Internally used to delegate something to the worker thread.</p></div></div></div></div></div></div></div><footer class="section dark site-footer"><div class="container"><div class="copyright"><p>This documentation is generated for version development @ fbbbf21</p><p>&copy; 2017 &nbsp;<a href="https://haxe.org/foundation/" title="Haxe Foundation Website" rel="external" class="hf-link">Haxe Foundation</a> |&nbsp;<a href="https://github.com/HaxeFoundation/haxe" rel="external" title="Haxe on Github">Contribute to Haxe</a></p></div></div></footer><script src="../..//highlighter.js"></script><link href="../../highlighter.css" rel="stylesheet"/></body></html>